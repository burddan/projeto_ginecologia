<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>CÃ¢mera Electron</title>
</head>
<body>
  <h1>CÃ¢mera do PC</h1>
  <video id="video" autoplay playsinline></video>

  <script>
    const video = document.getElementById("video");

    let mediaRecorder;
    let recordedChunks = [];
    let stream;
    let recording = false;

    async function initCamera() {
      stream = await navigator.mediaDevices.getUserMedia({ video: true });
      video.srcObject = stream;
    }

    async function chooseSaveFolder() {
      const folder = await window.electronAPI.chooseFolder();
      if (folder) {
        console.log("Pasta selecionada:", folder);
      } else {
        console.log("Nenhuma pasta selecionada, usando padrÃ£o");
      }
    }

    function startRecording() {
      recordedChunks = [];
      mediaRecorder = new MediaRecorder(stream, {
        mimeType: "video/webm; codecs=vp8"
      });

      mediaRecorder.ondataavailable = e => {
        if (e.data.size > 0) recordedChunks.push(e.data);
      };

      mediaRecorder.onstop = async () => {
        const blob = new Blob(recordedChunks, { type: "video/webm" });
        const buffer = await blob.arrayBuffer();

        const filename = `video-${Date.now()}.webm`;
        const path = await window.electronAPI.saveFile({ buffer, filename });

        console.log("VÃ­deo salvo em:", path);
      };

      mediaRecorder.start();
      recording = true;
      console.log("GravaÃ§Ã£o iniciada");
    }

    function stopRecording() {
      mediaRecorder.stop();
      recording = false;
      console.log("GravaÃ§Ã£o parada");
    }

    function takePhoto() {
      const canvas = document.createElement("canvas");
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;

      const ctx = canvas.getContext("2d");
      ctx.drawImage(video, 0, 0);

      canvas.toBlob(async blob => {
        const buffer = await blob.arrayBuffer();
        const filename = `photo-${Date.now()}.png`;

        const path = await window.electronAPI.saveFile({ buffer, filename });
        console.log("Foto salva em:", path);
      });
    }

    window.electronAPI.onRecordToggle(() => {
      recording ? stopRecording() : startRecording();
    });

    window.electronAPI.onPhotoTake(() => {
      takePhoto();
    });

    initCamera();
    chooseSaveFolder(); // ðŸ‘ˆ aqui
  </script>
</body>
</html>